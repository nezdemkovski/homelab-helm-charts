# Cloudflared specific configuration
cloudflared:
  image:
    repository: cloudflare/cloudflared
    tag: "2025.8.0"
    pullPolicy: IfNotPresent

  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

  # Health checks - Use process check for cloudflared
  livenessProbe:
    exec:
      command:
        - pgrep
        - cloudflared
    failureThreshold: 3
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5

  readinessProbe:
    exec:
      command:
        - pgrep
        - cloudflared
    failureThreshold: 3
    initialDelaySeconds: 15
    periodSeconds: 5
    timeoutSeconds: 3

  # Security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65532
    runAsGroup: 65532
    fsGroup: 65532
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65532
    runAsGroup: 65532
    capabilities:
      drop:
        - ALL
